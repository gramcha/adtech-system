version: "3.5"

#Docker host machine IP - copy below export command without # and execute before executing docker-compose command. or copy into bash_profile or bash.rc file.
#export DOCKER_HOST_IP=`ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'`

services:
  zookeeper:
    hostname: zookeeper
    image: wurstmeister/zookeeper:3.4.6
    ports:
      - "2181:2181"
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
  kafka:
    image: wurstmeister/kafka:1.0.0
    links:
     - zookeeper
    ports:
      - "9092:9092"
    environment:
      KAFKA_ADVERTISED_HOST_NAME: $DOCKER_HOST_IP
      KAFKA_ADVERTISED_PORT: 9092
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_CREATE_TOPICS: "delivery:1:1,click:1:1,install:1:1"
  redis:
    image: "redis:alpine"
    #hostname: redis
    ports:
     - "6379:6379"
    volumes:
      - ./data/redis:/data 
    #networks:
    #  - my-network-name
  ingest-service:
    build: ./ingest-service
    ports:
     - "8080:8080"
    depends_on:
      - redis
      - kafka
#    links:
#     - kafka
#      - redis:redis
    #networks:
    #  - my-network-name  
    #environment:
    #  SPRING_REDIS_HOST: $DOCKER_HOST_IP
#networks:
#  my-network-name:
#   name: my-global-net    
